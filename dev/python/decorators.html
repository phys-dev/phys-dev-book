<!DOCTYPE HTML>
<html lang="ru" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Декораторы и functools - Разработка и применение программного обеспечения в физических исследованиях</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../intro/intro.html">О книге</a></li><li class="chapter-item expanded affix "><a href="../../intro/about-me.html">О себе</a></li><li class="chapter-item expanded affix "><li class="part-title">Ищем помощников</li><li class="chapter-item expanded "><a href="../../ai/intro.html"><strong aria-hidden="true">1.</strong> ИИ для разработки</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ai/context.html"><strong aria-hidden="true">1.1.</strong> Контекст и скорость изменений</a></li><li class="chapter-item expanded "><a href="../../ai/develop.html"><strong aria-hidden="true">1.2.</strong> ИИ и разработчик</a></li><li class="chapter-item expanded "><a href="../../ai/basic.html"><strong aria-hidden="true">1.3.</strong> Технические основы</a></li><li class="chapter-item expanded "><a href="../../ai/instruments.html"><strong aria-hidden="true">1.4.</strong> Инструментарий</a></li><li class="chapter-item expanded "><a href="../../ai/qa.html"><strong aria-hidden="true">1.5.</strong> Вопросы и ответы</a></li></ol></li><li class="chapter-item expanded "><a href="../../dev/python/intro.html"><strong aria-hidden="true">2.</strong> Python</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../dev/python/basics.html"><strong aria-hidden="true">2.1.</strong> Basics</a></li><li class="chapter-item expanded "><a href="../../dev/python/numpy.html"><strong aria-hidden="true">2.2.</strong> Numpy</a></li><li class="chapter-item expanded "><a href="../../dev/python/scipy.html"><strong aria-hidden="true">2.3.</strong> Scipy</a></li><li class="chapter-item expanded "><a href="../../dev/python/matplotlib.html"><strong aria-hidden="true">2.4.</strong> Matplotlib</a></li><li class="chapter-item expanded "><a href="../../dev/python/holo.html"><strong aria-hidden="true">2.5.</strong> Holoviews</a></li><li class="chapter-item expanded "><a href="../../dev/python/requirements.html"><strong aria-hidden="true">2.6.</strong> Requirements</a></li></ol></li><li class="chapter-item expanded "><a href="../../dev/git.html"><strong aria-hidden="true">3.</strong> Git</a></li><li class="chapter-item expanded "><a href="../../dev/docker.html"><strong aria-hidden="true">4.</strong> Docker</a></li><li class="chapter-item expanded affix "><li class="part-title">Загружаем linux</li><li class="chapter-item expanded "><a href="../../linux/intro.html"><strong aria-hidden="true">5.</strong> Основы Linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../linux/booting.html"><strong aria-hidden="true">5.1.</strong> Процесс загрузки</a></li><li class="chapter-item expanded "><a href="../../linux/filesystems.html"><strong aria-hidden="true">5.2.</strong> Файловые системы</a></li><li class="chapter-item expanded "><a href="../../linux/tools.html"><strong aria-hidden="true">5.3.</strong> Инструменты</a></li></ol></li><li class="chapter-item expanded "><a href="../../linux/install-arch-linux.html"><strong aria-hidden="true">6.</strong> Установка Arch Linux</a></li><li class="chapter-item expanded "><a href="../../linux/structure.html"><strong aria-hidden="true">7.</strong> Внутреннее устройство Linux</a></li><li class="chapter-item expanded affix "><li class="part-title">Погружаемся в Python</li><li class="chapter-item expanded "><a href="../../dev/python/init.html"><strong aria-hidden="true">8.</strong> Начало</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../dev/python/objects.html"><strong aria-hidden="true">8.1.</strong> Объекты и память</a></li><li class="chapter-item expanded "><a href="../../dev/python/collections.html"><strong aria-hidden="true">8.2.</strong> Коллекции</a></li><li class="chapter-item expanded "><a href="../../dev/python/o-notation.html"><strong aria-hidden="true">8.3.</strong> Асимптотическая сложность</a></li></ol></li><li class="chapter-item expanded "><a href="../../dev/python/functions.html"><strong aria-hidden="true">9.</strong> Функции</a></li><li class="chapter-item expanded "><a href="../../dev/python/decorators.html" class="active"><strong aria-hidden="true">10.</strong> Декораторы и functools</a></li><li class="chapter-item expanded "><a href="../../dev/python/classes.html"><strong aria-hidden="true">11.</strong> Классы</a></li><li class="chapter-item expanded "><a href="../../dev/python/async.html"><strong aria-hidden="true">12.</strong> Итераторы, генераторы и корутины</a></li><li class="chapter-item expanded affix "><li class="part-title">Изучаем хорошие практики</li><li class="chapter-item expanded "><a href="../../dev/life.html"><strong aria-hidden="true">13.</strong> Жизненный цикл ПО</a></li><li class="chapter-item expanded "><a href="../../dev/python/optimization.html"><strong aria-hidden="true">14.</strong> Оптимизация по времени и памяти</a></li><li class="chapter-item expanded "><a href="../../dev/python/numpy-and-pandas.html"><strong aria-hidden="true">15.</strong> Обработка данных</a></li><li class="chapter-item expanded "><a href="../../dev/python/visualization/practice.html"><strong aria-hidden="true">16.</strong> Визуализация данных</a></li><li class="chapter-item expanded affix "><li class="part-title">Учимся у других</li><li class="chapter-item expanded "><a href="../../examples/intro.html"><strong aria-hidden="true">17.</strong> Коды и скрипты</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../examples/kenv.html"><strong aria-hidden="true">17.1.</strong> Уравнение огибающей Капчинского-Владимирского для пучка заряженных частиц</a></li><li class="chapter-item expanded "><a href="../../examples/envelope-optimize.html"><strong aria-hidden="true">17.2.</strong> Оптимизация огибающей пучка заряженных частиц с помощью генетического алгоритма</a></li><li class="chapter-item expanded "><a href="../../examples/redpic.html"><strong aria-hidden="true">17.3.</strong> Релятивистская разностная схема для расчета динамики частиц в сложных электрических и магнитных полях</a></li><li class="chapter-item expanded "><a href="../../examples/async-api.html"><strong aria-hidden="true">17.4.</strong> Асинхронное API для кинотеатра</a></li><li class="chapter-item expanded "><a href="../../examples/matrix-product.html"><strong aria-hidden="true">17.5.</strong> Перемножение матриц</a></li><li class="chapter-item expanded "><a href="../../examples/cadquery/layout.html"><strong aria-hidden="true">17.6.</strong> Схема ускорителя заряженных частиц в CadQuery</a></li></ol></li><li class="chapter-item expanded "><a href="../../resume/literature.html"><strong aria-hidden="true">18.</strong> Литература и статьи</a></li><li class="chapter-item expanded affix "><li class="part-title">Работаем самостоятельно</li><li class="chapter-item expanded "><a href="../../practicum/review-code-task.html"><strong aria-hidden="true">19.</strong> Ищем ошибки в чужом коде</a></li><li class="chapter-item expanded "><a href="../../practicum/markov-chain-task.html"><strong aria-hidden="true">20.</strong> Делаем свою LLM</a></li><li class="chapter-item expanded "><a href="../../practicum/booting-linux-task.html"><strong aria-hidden="true">21.</strong> Установка Linux</a></li><li class="chapter-item expanded "><a href="../../practicum/linux-tools-task.html"><strong aria-hidden="true">22.</strong> Набор упражнений для работы в Linux</a></li><li class="chapter-item expanded "><a href="../../practicum/linux-structure-task.html"><strong aria-hidden="true">23.</strong> Маленькая задачка c Linux</a></li><li class="chapter-item expanded "><a href="../../practicum/python-algo-task.html"><strong aria-hidden="true">24.</strong> Пишем эффективный код</a></li><li class="chapter-item expanded "><a href="../../practicum/kitty-startup-task.html"><strong aria-hidden="true">25.</strong> Деплой стартапа</a></li><li class="chapter-item expanded "><a href="../../practicum/final-project-requirements.html"><strong aria-hidden="true">26.</strong> Итоговый проект</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Разработка и применение программного обеспечения в физических исследованиях</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/phys-dev/book/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="Декораторы-и-модуль-functools"><a class="header" href="#Декораторы-и-модуль-functools">Декораторы и модуль <code>functools</code></a></h1>
<p>Декораторы в Python — это мощный инструмент для модификации поведения функций и методов, позволяющий писать чистый, повторно используемый и легко читаемый код. В этой главе мы глубоко погрузимся в мир декораторов, изучим их синтаксис, создание, применение, а также познакомимся с полезными инструментами из модуля <code>functools</code>.</p>
<h2 id="Синтаксис-декораторов"><a class="header" href="#Синтаксис-декораторов">Синтаксис декораторов</a></h2>
<p>Декоратор — это функция, которая принимает другую функцию и возвращает новую функцию (или любой другой объект). Синтаксис декоратора — это «синтаксический сахар», который делает код более понятным.</p>
<pre><code class="language-python">@decorator
def foo(x):
    return 42
</code></pre>
<p>Эквивалентно:</p>
<pre><code class="language-python">def foo(x):
    return 42

foo = decorator(foo)
</code></pre>
<p>Таким образом, после применения декоратора имя <code>foo</code> будет ссылаться на результат вызова <code>decorator(foo)</code>.</p>
<h2 id="Теория-декораторов-создание-простого-декоратора"><a class="header" href="#Теория-декораторов-создание-простого-декоратора">«Теория» декораторов: создание простого декоратора</a></h2>
<p>Рассмотрим пример декоратора <code>trace</code>, который логирует вызовы функции:</p>
<pre><code class="language-python">def trace(func):
    def inner(*args, **kwargs):
        print(func.__name__, args, kwargs)
        return func(*args, **kwargs)
    return inner
</code></pre>
<p>Применим его:</p>
<pre><code class="language-python">@trace
def identity(x):
    "I do nothing useful."
    return x

identity(42)  # Вывод: identity (42,) {} → 42
</code></pre>
<h3 id="Проблема-атрибутов-функции"><a class="header" href="#Проблема-атрибутов-функции">Проблема атрибутов функции</a></h3>
<p>После применения декоратора исходные атрибуты функции (такие как <code>__name__</code>, <code>__doc__</code>) теряются:</p>
<pre><code class="language-python">identity.__name__  # 'inner'
help(identity)     # Справка о inner, а не identity
</code></pre>
<h3 id="Решение-functoolswraps"><a class="header" href="#Решение-functoolswraps">Решение: <code>functools.wraps</code></a></h3>
<p>Модуль <code>functools</code> предоставляет декоратор <code>wraps</code>, который копирует метаданные исходной функции в декорированную:</p>
<pre><code class="language-python">import functools

def trace(func):
    @functools.wraps(func)
    def inner(*args, **kwargs):
        print(func.__name__, args, kwargs)
        return func(*args, **kwargs)
    return inner
</code></pre>
<p>Теперь <code>identity.__name__</code> и <code>help(identity)</code> работают корректно.</p>
<h2 id="Декораторы-с-аргументами"><a class="header" href="#Декораторы-с-аргументами">Декораторы с аргументами</a></h2>
<p>Иногда нужно параметризовать декоратор. Например, указать файл для вывода в <code>trace</code>:</p>
<pre><code class="language-python">def trace(handle):
    def decorator(func):
        @functools.wraps(func)
        def inner(*args, **kwargs):
            print(func.__name__, args, kwargs, file=handle)
            return func(*args, **kwargs)
        return inner
    return decorator

@trace(sys.stderr)
def identity(x):
    return x
</code></pre>
<p>Эквивалентно:</p>
<pre><code class="language-python">decorator = trace(sys.stderr)
identity = decorator(identity)
</code></pre>
<h2 id="Декораторы-с-опциональными-аргументами"><a class="header" href="#Декораторы-с-опциональными-аргументами">Декораторы с опциональными аргументами</a></h2>
<p>Чтобы декоратор можно было использовать как с аргументами, так и без них, применяют следующий паттерн:</p>
<pre><code class="language-python">def trace(func=None, *, handle=sys.stdout):
    if func is None:
        return lambda func: trace(func, handle=handle)

    @functools.wraps(func)
    def inner(*args, **kwargs):
        print(func.__name__, args, kwargs, file=handle)
        return func(*args, **kwargs)
    return inner
</code></pre>
<p>Использование:</p>
<pre><code class="language-python">@trace
def foo(): ...

@trace(handle=sys.stderr)
def bar(): ...
</code></pre>
<p><strong>Зачем только ключевые аргументы?</strong> Это предотвращает неоднозначность при вызове и делает код чище.</p>
<h2 id="Практика-полезные-декораторы"><a class="header" href="#Практика-полезные-декораторы">Практика: полезные декораторы</a></h2>
<h3 id="timethis--замер-времени-выполнения"><a class="header" href="#timethis--замер-времени-выполнения">@timethis — замер времени выполнения</a></h3>
<pre><code class="language-python">import time

def timethis(func=None, *, n_iter=100):
    if func is None:
        return lambda func: timethis(func, n_iter=n_iter)

    @functools.wraps(func)
    def inner(*args, **kwargs):
        print(func.__name__, end=" ... ")
        acc = float("inf")
        for i in range(n_iter):
            tick = time.perf_counter()
            result = func(*args, **kwargs)
            acc = min(acc, time.perf_counter() - tick)
        print(acc)
        return result
    return inner
</code></pre>
<h3 id="once--выполнить-не-более-одного-раза"><a class="header" href="#once--выполнить-не-более-одного-раза">@once — выполнить не более одного раза</a></h3>
<pre><code class="language-python">def once(func):
    @functools.wraps(func)
    def inner(*args, **kwargs):
        if not inner.called:
            inner.result = func(*args, **kwargs)
            inner.called = True
        return inner.result
    inner.called = False
    return inner
</code></pre>
<h3 id="memoized--мемоизация"><a class="header" href="#memoized--мемоизация">@memoized — мемоизация</a></h3>
<pre><code class="language-python">def memoized(func):
    cache = {}
    @functools.wraps(func)
    def inner(*args, **kwargs):
        key = args + tuple(sorted(kwargs.items()))
        if key not in cache:
            cache[key] = func(*args, **kwargs)
        return cache[key]
    return inner
</code></pre>
<p><strong>Проблема:</strong> Словари нехэшируемы. Для универсального решения можно сериализовать аргументы в строку (например, через <code>pickle</code>).</p>
<h3 id="deprecated--пометить-функцию-как-устаревшую"><a class="header" href="#deprecated--пометить-функцию-как-устаревшую">@deprecated — пометить функцию как устаревшую</a></h3>
<pre><code class="language-python">import warnings

def deprecated(func):
    code = func.__code__
    warnings.warn_explicit(
        f"{func.__name__} is deprecated.",
        category=DeprecationWarning,
        filename=code.co_filename,
        lineno=code.co_firstlineno + 1
    )
    return func
</code></pre>
<h2 id="Контрактное-программирование-с-декораторами"><a class="header" href="#Контрактное-программирование-с-декораторами">Контрактное программирование с декораторами</a></h2>
<p>Реализуем простые контракты <code>@pre</code> и <code>@post</code>:</p>
<pre><code class="language-python">def pre(cond, message):
    def decorator(func):
        @functools.wraps(func)
        def inner(*args, **kwargs):
            assert cond(*args, **kwargs), message
            return func(*args, **kwargs)
        return inner
    return decorator

def post(cond, message):
    def decorator(func):
        @functools.wraps(func)
        def inner(*args, **kwargs):
            result = func(*args, **kwargs)
            assert cond(result), message
            return result
        return inner
    return decorator
</code></pre>
<p>Использование:</p>
<pre><code class="language-python">@pre(lambda x: x &gt;= 0, "negative argument")
@post(lambda r: not math.isnan(r), "result is NaN")
def log_positive(x):
    return math.log(x)
</code></pre>
<h2 id="Цепочки-декораторов"><a class="header" href="#Цепочки-декораторов">Цепочки декораторов</a></h2>
<p>Порядок применения декораторов имеет значение:</p>
<pre><code class="language-python">@deco1
@deco2
def foo(): ...
</code></pre>
<p>Эквивалентно:</p>
<pre><code class="language-python">foo = deco1(deco2(foo))
</code></pre>
<h2 id="Модуль-functools"><a class="header" href="#Модуль-functools">Модуль <code>functools</code></a></h2>
<h3 id="lru_cache--мемоизация-с-ограничением"><a class="header" href="#lru_cache--мемоизация-с-ограничением"><code>lru_cache</code> — мемоизация с ограничением</a></h3>
<pre><code class="language-python">@functools.lru_cache(maxsize=128)
def expensive_func(x):
    return x * x
</code></pre>
<ul>
<li><code>maxsize=None</code> — неограниченный кэш (опасно при большом количестве вызовов!).</li>
<li><code>cache_info()</code> — статистика использования кэша.</li>
</ul>
<h3 id="partial--частичное-применение"><a class="header" href="#partial--частичное-применение"><code>partial</code> — частичное применение</a></h3>
<pre><code class="language-python">f = functools.partial(sorted, key=lambda x: x[1])
f([('a', 4), ('b', 2)])  # [('b', 2), ('a', 4)]
</code></pre>
<h3 id="singledispatch--обобщённые-функции"><a class="header" href="#singledispatch--обобщённые-функции"><code>singledispatch</code> — обобщённые функции</a></h3>
<p>Позволяет определять разные реализации функции для разных типов:</p>
<pre><code class="language-python">@functools.singledispatch
def pack(obj):
    raise TypeError(f"Unsupported type: {type(obj)}")

@pack.register(int)
def _(obj):
    return b"I" + hex(obj).encode("ascii")

@pack.register(list)
def _(obj):
    return b"L" + b",".join(map(pack, obj))
</code></pre>
<h3 id="reduce--свёртка-последовательности"><a class="header" href="#reduce--свёртка-последовательности"><code>reduce</code> — свёртка последовательности</a></h3>
<pre><code class="language-python">functools.reduce(lambda acc, x: acc * x, [1, 2, 3, 4])  # 24
</code></pre>
<p>Хотя <code>reduce</code> популярен в функциональных языках, в Python его используют редко, предпочитая явные циклы для ясности.</p>
<h2 id="Заключение"><a class="header" href="#Заключение">Заключение</a></h2>
<p>Декораторы — это не просто «синтаксический сахар», а фундаментальный инструмент метапрограммирования в Python. Они позволяют:</p>
<ul>
<li>Модифицировать поведение функций без изменения их кода.</li>
<li>Реализовывать аспектно-ориентированное программирование.</li>
<li>Создавать выразительные и легко читаемые API.</li>
</ul>
<p>Модуль <code>functools</code> предоставляет готовые решения для многих задач, связанных с функциональным программированием и декорированием.</p>
<p><strong>Дополнительные материалы:</strong></p>
<ul>
<li><a href="https://wiki.python.org/moin/PythonDecoratorLibrary">Python Decorator Library</a></li>
<li><a href="https://peps.python.org/pep-0443/">PEP 443 – Single-dispatch generic functions</a></li>
<li><a href="https://peps.python.org/pep-0318/">PEP 318 – Decorators for Functions and Methods</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../dev/python/functions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../dev/python/classes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../dev/python/functions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../dev/python/classes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
